import os, re, hashlib,signal,subprocess,sys
import sqlite3
import db
import detect
import time

signatures=db.connect_db()

our_pid=os.getpid()
old_pids=[]
pids = [pid for pid in os.listdir('/proc') if pid.isdigit() ]
pids=pids[:len(pids)-1]

detect.detect_and_kill(pids,signatures,our_pid)


while True:
    time.sleep(1)
    pids = [pid for pid in os.listdir('/proc') if (pid.isdigit() and int(pid)>int(our_pid)) ]
    if old_pids!=pids and len(pids)>0:
        detect.detect_and_kill(pids,signatures,our_pid)
    old_pids=pids